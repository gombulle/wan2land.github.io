---
layout: post
title: 프레임워크 만들기 (1) - 구조
date: 2015-12-17 20:54:05 +09:00
tags: ['PHP']
---

프레임워크 만들기, 가장 많이 들은 말 중에 하나가 "왜 만들어요?" 였습니다. 글쎄요, 처음에는 그냥 공부했던 내용을 다시
차곡차곡 쌓으면서 시작했던것 같습니다. 지금은 그냥 만들고 싶으니까 만드는 것 같습니다. :-)

엄청 대단한 프로젝트는 아니지만, 만들면서 느꼈던 것, 생각했던 것을 다시 한번 돌이켜보며 블로그에 정리해보려고 합니다.

## 프레임워크란?

"애플리케이션 프레임워크(Application Framework)는 프로그래밍에서 특정 운영 체제를 위한 응용 프로그램 표준 구조를
구현하는 클래스와 라이브러리 모임이다."

- https://ko.wikipedia.org/wiki/%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98_%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC - 

위키백과는 위와 같이 정의하고 있습니다. 라이브러리의 모임, 이 조건만 만족해도 프레임워크라는 최소한의 조건을 갖춘다고
생각합니다. 

..................으헝..쓰기 귀찮..


## 생각하기

처음엔 고민을 해보는게 좋습니다. 구조도 좋고, 목적도 좋습니다.
프레임워크는 많은 부분으로 생성되는데 각 모듈은 갈아치우기가 너무 힘들었습니다. 즉, 서로간의 커플링이 너무 강하게
결합되어있는 느낌이었습니다. 그래서 애초에 전략을 거꾸로 펼쳐보기로 하였습니다. 컴포넌트에서 부터 시작해서 프레임워크로
올라가는 방식말이죠.

## Wandu DI

### TDD

옛날 PHP는 절차지향으로 코드를 작성해나갔습니다. 물론 읽어내려가기만 하면 되는 아주 훌륭한 방식입니다. 그러나, 

### 의존성 주입

이전 글()에서도 한번 다루었지만 프레임워크를 만들 때 뿐 아니라, 객체지향 프로그래밍에서 거의 필수적인 개념이라고
생각합니다. 왜 그런고 하니, 절차지향에서는 어떤 행동 하나를 절차대로 분리를 합니다. 그래서 세세한 내용으로 들어가면
갈수록 복잡도가 높아지게 됩니다. 그러나 객체지향의 핵심은 바로 객체간의 관계를 기술해 나아가는 프로그래밍이기 때문에
전체를 보았을 땐, 더 복잡해 보일 수 있지만 객체 각각을 보았을 때는 아주 단순하게 구성되어있는 것이 대부분입니다.

예를들면..(생략)

즉, 내가 특정 객체 A를 만든다고 했을 때, A라는 객체에 영향을 주는 녀석, B, C와의 관계만을 기술하면 끝이납니다.
그리고, 여기서 데이터를 떠올렸을 때, 해당 데이터가 필요한 시점에 생성자를 통해서 주입을 받던지, 아니면 매서드를 호출
할때 같이 보내주던지, 둘 중 한가지 방식으로 서로의 객체를 연결할 수 있게 됩니다.

뭐 블라블라..

그래서 나온 프로젝트가 `Wandu DI` 입니다.

## Wandu HTTP

기왕이면 가장 현대적인 프레임워크가 되고 싶었습니다. 그래서 PSR에서 나온 Http 표준인 Psr-7을 사용해보기로 하였습니다.
그런데 당시에 Interface만 존재하였고, ..
Psr7이 엄청 미흡합니다. Session 도 없고, Cookie도 없습니다. 차라리 Symfony에서 나온 Http Component를 사용하는게 나을
지경이었습니다. 그러나, 많은 개발자들이 투표를 통해 앞으로 지원하겠다는 것을 보고 당연히 나도 저걸 적용해야겠다는
생각이 들었습니다.

가장 많이 참고로 한 패키지는 Phly/Http 였습니다. 해당 패키지랑 사실 거의 유사한데, 저는 이 Http객체를 DI에서 사용해야
했습니다. 그런데 해당 패키지의 경우 interface / trait를 별도로 구성하고 클래스를 해당 trait의 조합을 통해 만들었습니다.
그래서 문제가 무엇인고 하니, ServerReqeustInterface는 ReqeustInterface를 상속받게 됩니다. 그러나, ServerReqeust는 
Reqeust객체를 상속받지 않습니다. 즉, ServerRequestInterface is RequestInterface는 성립하지만 ServerRequest is Request는
성립하지 않는 조금은 당황스러운 상황이 발생하게 되었습니다.



## Wandu Router

